<div class="locale-setup">
    <div class="add-formula">
        <h3>
            <span class="mdi" (click)="toggleFormula = !toggleFormula">
        {{ toggleFormula ? "arrow_drop_down" : "arrow_right" }}
      </span> Add a Locale
            <span>[Conversion from USD - IDR]</span>
            <span *ngIf="app.create('locale')" class="add mdi" (click)="addLocale = !addLocale">{{ !addLocale ? "add" : "clear" }}</span
      >
    </h3>
    <div *ngIf="toggleFormula">
      <div class="long-form" *ngIf="addLocale">
        <form [formGroup]="formula">
          <mat-form-field class="w115">
            <mat-label>Locale Name</mat-label>
            <input formControlName="name" matInput maxlength="25" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Variation Factor</mat-label>
            <input formControlName="variationFactor" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Volumetric Wt. Factor</mat-label>
            <input
              formControlName="volumetricWtFactor"
              matInput
              type="number"
            />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Packing Cost</mat-label>
            <input formControlName="packingCost" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Freight [USA - DXB] per KG</mat-label>
            <input formControlName="freightUD" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="w115">
            <mat-label>Freight [DXB - CGK] per KG</mat-label>
            <input formControlName="freightDC" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Custom Clearance / KG</mat-label>
            <input formControlName="ccpKG" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Custom Clearance / HAWB</mat-label>
            <input formControlName="ccpHAWB" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Sensitive Cargo / HAWB</mat-label>
            <input formControlName="sensitiveCargo" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Pickup / Handling Charges</mat-label>
            <input formControlName="handlingCharges" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="w115">
            <mat-label>Markup in %</mat-label>
            <input formControlName="markUp" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>BEA CUKAI in %</mat-label>
            <input formControlName="beaCukai" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Platform Comission %</mat-label>
            <input formControlName="pfComission" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>PPN in %</mat-label>
            <input formControlName="ppn" matInput type="number" />
          </mat-form-field>
          <mat-form-field class="left10px w115">
            <mat-label>Currency Conversion value</mat-label>
            <input formControlName="ccv" matInput type="number" />
          </mat-form-field>
          <br />
          <div class="action-buttons">
            <button
              mat-raised-button
              color="primary"
              (click)="add()"
              [disabled]="formula && !formula.valid"
            >
              <span class="mdi">schedule</span>Add
            </button>
            <button class="left10px" mat-raised-button color="secondary" (click)="reset()">
              <span class="mdi">clear_all</span>Reset
            </button>
    </div>
    </form>
</div>
<div class="locale-list">
    <table mat-table [dataSource]="locales" *ngIf="locales && locales.length" class="mat-elevation-z8">
        <ng-container [matColumnDef]="item.key" *ngFor="let item of displayedColumnsList">
            <th mat-header-cell *matHeaderCellDef [title]="item.label">
                {{ item.label }}.
            </th>
            <td mat-cell *matCellDef="let element">
                <div *ngIf="item.key !== 'lactions'">{{ element[item.key] }}</div>
                <div *ngIf="item.key === 'lactions'">
                    <span (click)="removeLocale(element)" class="mdi red">delete_outline</span
                >
                <span (click)="cloneLocale(element)" class="mdi copy"> file_copy </span>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
</div>
</div>
</div>
<div class="apply-formula">
    <h3>
        <span class="mdi" (click)="toggleApplyFormula = !toggleApplyFormula">
        {{ toggleApplyFormula ? "arrow_drop_down" : "arrow_right" }}
      </span> Apply a Locale
    </h3>
    <div *ngIf="toggleApplyFormula">
        <form [formGroup]="newFormula" *ngIf="app.create('locale')">
            <mat-form-field>
                <mat-label>Choose a Category</mat-label>
                <mat-select formControlName="category" (selectionChange)="updateSubCategory($event)">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let category of categories" [value]="category">
                        {{ category.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px" *ngIf="subCategories && subCategories.length">
                <mat-label>Choose a Sub Category 1</mat-label>
                <mat-select formControlName="subCategory" (selectionChange)="updateSubCategory1($event)">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories" [value]="sCategory">
                        {{ sCategory.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px" *ngIf="subCategories1 && subCategories1.length">
                <mat-label>Choose a Sub Category 2</mat-label>
                <mat-select formControlName="subCategory1" (selectionChange)="updateSubCategory2($event)">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories1" [value]="sCategory">
                        {{ sCategory.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px" *ngIf="subCategories2 && subCategories2.length">
                <mat-label>Choose a Sub Category 3</mat-label>
                <mat-select formControlName="subCategory2" (selectionChange)="updateSubCategory3($event)">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories2" [value]="sCategory">
                        {{ sCategory.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px" *ngIf="subCategories3 && subCategories3.length">
                <mat-label>Choose a Sub Category 4</mat-label>
                <mat-select formControlName="subCategory3">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories3" [value]="sCategory">
                        {{ sCategory.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px right10px">
                <mat-label>Locale</mat-label>
                <mat-select formControlName="locale">
                    <mat-option value="">-Select-</mat-option>
                    <mat-option *ngFor="let d of locales" [value]="d">
                        {{ d.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class="action-buttons">
                <button mat-raised-button color="primary" (click)="apply('addLog')" [disabled]="!newFormula.value.category || !newFormula.value.locale">
            <span class="mdi">save</span>Save
          </button>
                <!-- <button class="left10px" mat-raised-button color="primary" (click)="apply('applyLog')"
                      [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                          class="mdi">schedule</span>Apply</button> -->
                <!-- <button class="left10px" mat-raised-button color="primary" (click)="apply('applyLog', true)"
                      [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                          class="mdi">schedule</span>Apply Recursively</button> -->
                <button class="left10px" mat-raised-button color="secondary" (click)="resetNewFormula()">
            <span class="mdi">clear_all</span>Reset
          </button>
            </div>
        </form>

        <div class="locale-list w100">
            <table mat-table [dataSource]="localeUpdates" *ngIf="localeUpdates && localeUpdates.length" class="mat-elevation-z8">
                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef>Category.</th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.category.name }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="subCategory">
                    <th mat-header-cell *matHeaderCellDef>Sub-Category.</th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.subCategory.name }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="recursive">
                    <th mat-header-cell *matHeaderCellDef>Recursive.</th>
                    <td mat-cell *matCellDef="let element">
                        <mat-checkbox [disabled]="!app.create('locale')" [(ngModel)]="element.recursive" (ngModelChange)="recursiveChange(element)"></mat-checkbox>
                    </td>
                </ng-container>
                <ng-container matColumnDef="locale">
                    <th mat-header-cell *matHeaderCellDef>Locale.</th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.locale.name }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="count">
                    <th mat-header-cell *matHeaderCellDef>Applied to.</th>
                    <td mat-cell *matCellDef="let element" (click)="navToPdts(element)" [ngClass]="{ link: element.count }">
                        {{ element.count }} Products
                    </td>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row" align="right">
                        <span *ngIf="app.create('locale')" title="Apply" class="left10px mdi" [ngClass]="{ disabled: row.status === 'applied' }" (click)="
                  row.status !== 'applied' ? apply('applyOnly', false, row) : ''
                ">done</span
              >
              <!-- <span
                *ngIf="app.create('locale')"
                title="Apply Recursively"
                class="left10px mdi"
                [ngClass]="{ disabled: row.recursive }"
                (click)="!row.recursive ? apply('applyLog', true, row) : ''"
                >published_with_changes</span
              > -->
              <span
                title="Refresh products count"
                (click)="refresh(row)"
                *ngIf="row.status === 'saved'"
                class="mdi left10px"
                >refresh</span
              >
              <span
                *ngIf="app.delete('locale')"
                title="Remove"
                (click)="archiveLocale(row)"
                class="mdi left10px"
                >delete</span
              >
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedApplyColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedApplyColumns"></tr>
        </table>
      </div>
    </div>
  </div>
</div>