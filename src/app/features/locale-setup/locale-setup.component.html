<div class="locale-setup">
    <div class="add-formula">
        <h3>Add a Locale <span>[Conversion from USD - IDR]</span> <span class="add mdi"
                (click)="addLocale = !addLocale">{{!addLocale ? 'add' : 'clear'}}</span></h3>
        <div class="long-form" *ngIf="addLocale">
            <form [formGroup]="formula">
                <mat-form-field class="w115">
                    <mat-label>Locale Name</mat-label>
                    <input formControlName="name" matInput maxlength="25">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Variation Factor</mat-label>
                    <input formControlName="variationFactor" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Volumetric Wt. Factor</mat-label>
                    <input formControlName="volumetricWtFactor" matInput type="number">
                </mat-form-field>
                <mat-form-field class="w115">
                    <mat-label>Packing Cost</mat-label>
                    <input formControlName="packingCost" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Freight [USA - DXB] per KG</mat-label>
                    <input formControlName="freightUD" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Freight [DXB - CGK] per KG</mat-label>
                    <input formControlName="freightDC" matInput type="number">
                </mat-form-field>
                <mat-form-field class="w115">
                    <mat-label>Custom Clearance / KG</mat-label>
                    <input formControlName="ccpKG" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Custom Clearance / HAWB</mat-label>
                    <input formControlName="ccpHAWB" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Sensitive Cargo / HAWB</mat-label>
                    <input formControlName="sensitiveCargo" matInput type="number">
                </mat-form-field>
                <mat-form-field class="w115">
                    <mat-label>Pickup / Handling Charges</mat-label>
                    <input formControlName="handlingCharges" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>Markup in %</mat-label>
                    <input formControlName="markUp" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>BEA CUKAI in %</mat-label>
                    <input formControlName="beaCukai" matInput type="number">
                </mat-form-field>
                <mat-form-field class="w115">
                    <mat-label>Platform Comission %</mat-label>
                    <input formControlName="pfComission" matInput type="number">
                </mat-form-field>
                <mat-form-field class="left10px w115">
                    <mat-label>PPN in %</mat-label>
                    <input formControlName="ppn" matInput type="number">
                </mat-form-field>
                <br>
                <div class="action-buttons">
                    <button mat-raised-button color="primary" (click)="add()"
                        [disabled]="formula && !formula.valid"><span class="mdi">schedule</span>Add</button>
                    <button class="left10px" mat-raised-button color="secondary" (click)="reset()">
                        <span class="mdi">clear_all</span>Reset</button>
                </div>
            </form>
        </div>
        <div class="locale-list">
            <table mat-table [dataSource]="locales" *ngIf="locales && locales.length" class="mat-elevation-z8">
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name. </th>
                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                </ng-container>
                <ng-container matColumnDef="variationFactor">
                    <th mat-header-cell *matHeaderCellDef> Price Variation Factor.[%] </th>
                    <td mat-cell *matCellDef="let element"> {{element.variationFactor}} </td>
                </ng-container>
                <ng-container matColumnDef="markUp">
                    <th mat-header-cell *matHeaderCellDef> markUp.[%] </th>
                    <td mat-cell *matCellDef="let element"> {{element.markUp}} </td>
                </ng-container>
                <ng-container matColumnDef="ccpKG">
                    <th mat-header-cell *matHeaderCellDef> Custom Clearance. </th>
                    <td mat-cell *matCellDef="let element"> {{element.ccpKG}} / KILO & {{element.ccpHAWB}} / HAWB </td>
                </ng-container>
                <ng-container matColumnDef="ppn">
                    <th mat-header-cell *matHeaderCellDef> PPN.[%] </th>
                    <td mat-cell *matCellDef="let element"> {{element.ppn}} </td>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row"> <span (click)="removeLocale(row)"
                            class="mdi red">delete_outline</span> </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
    </div>
    <div class="apply-formula">
        <h3>Apply a Locale</h3>
        <form [formGroup]="newFormula">
            <mat-form-field>
                <mat-label>Choose a Category</mat-label>
                <mat-select formControlName="category" (selectionChange)="updateSubCategory($event)">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let category of categories" [value]="category">
                        {{category.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px">
                <mat-label>Choose a Sub Category</mat-label>
                <mat-select formControlName="subCategory">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories" [value]="sCategory">
                        {{sCategory.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px right10px">
                <mat-label>Locale</mat-label>
                <mat-select formControlName="locale">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let d of locales" [value]="d">
                        {{d.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class="action-buttons">
                <button mat-raised-button color="primary" (click)="apply('addLog')"
                    [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                        class="mdi">save</span>Save</button>
                <!-- <button class="left10px" mat-raised-button color="primary" (click)="apply('applyLog')"
                    [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                        class="mdi">schedule</span>Apply</button> -->
                <!-- <button class="left10px" mat-raised-button color="primary" (click)="apply('applyLog', true)"
                    [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                        class="mdi">schedule</span>Apply Recursively</button> -->
                <button class="left10px" mat-raised-button color="secondary" (click)="resetNewFormula()"><span
                        class="mdi">clear_all</span>Reset</button>
            </div>
        </form>

        <div class="locale-list w100">
            <table mat-table [dataSource]="localeUpdates" *ngIf="localeUpdates && localeUpdates.length"
                class="mat-elevation-z8">
                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef> Category. </th>
                    <td mat-cell *matCellDef="let element"> {{element.category.name}} </td>
                </ng-container>
                <ng-container matColumnDef="subCategory">
                    <th mat-header-cell *matHeaderCellDef> Sub-Category. </th>
                    <td mat-cell *matCellDef="let element"> {{element.subCategory.name}} </td>
                </ng-container>
                <ng-container matColumnDef="recursive">
                    <th mat-header-cell *matHeaderCellDef> Recursive. </th>
                    <td mat-cell *matCellDef="let element"> {{element.recursive ? 'Yes' : 'No'}} </td>
                </ng-container>
                <ng-container matColumnDef="locale">
                    <th mat-header-cell *matHeaderCellDef> Locale. </th>
                    <td mat-cell *matCellDef="let element"> {{element.locale.name}} </td>
                </ng-container>
                <ng-container matColumnDef="count">
                    <th mat-header-cell *matHeaderCellDef> Applied to. </th>
                    <td mat-cell *matCellDef="let element" (click)="navToPdts(element)"
                        [ngClass]="{'link': element.count}"> {{element.count}} Products</td>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row">
                        <button (click)="apply('applyOnly', false, row)" class="left10px" mat-raised-button
                            color="primary" [disabled]="row.status === 'applied'">{{row.status === 'saved' ? 'Apply' :
                            'Applied'}}</button>
                        <button class="left10px" mat-raised-button color="primary" (click)="apply('applyLog', true, row)"
                        [disabled]="row.recursive">Apply Recursively</button>
                    </td>
                </ng-container>
                <ng-container matColumnDef="refresh">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row"> <span (click)="refresh(row)" *ngIf="row.status === 'saved'"
                            class="mdi right10px">refresh</span></td>
                </ng-container>
                <ng-container matColumnDef="archive">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row"> <span (click)="archiveLocale(row)" class="mdi">archive</span>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedApplyColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedApplyColumns;"></tr>
            </table>
        </div>
    </div>
</div>