<div class="locale-setup">
    <div class="add-formula">
        <h3>Add a Locale</h3>
        <form [formGroup]="formula">
            <mat-form-field>
                <mat-label>Locale Name</mat-label>
                <input formControlName="name" #to matInput maxlength="25">
            </mat-form-field>
            <mat-form-field class="left10px w115">
                <mat-label>Dealer Charge</mat-label>
                <input formControlName="dealerCharge" #to matInput maxlength="4" (keydown)="numberOnly($event)">
            </mat-form-field>
            <mat-form-field class="w25">
                <mat-select formControlName="dealerChargeType">
                    <mat-option *ngFor="let value of values" [value]="value">{{value}}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px w115">
                <mat-label>Delivery Charge</mat-label>
                <input formControlName="deliveryCharge" #to matInput maxlength="4" (keydown)="numberOnly($event)">
            </mat-form-field>
            <mat-form-field class="w25 right10px">
                <mat-select formControlName="deliveryChargeType">
                    <mat-option *ngFor="let value of values" [value]="value">{{value}}</mat-option>
                </mat-select>
            </mat-form-field>
            <div class="action-buttons">
                <button mat-raised-button color="primary" (click)="add()"
                    [disabled]="!formula.value.name || !(formula.value.deliveryCharge || formula.value.dealerCharge)"><span
                        class="mdi">schedule</span>Add</button>
                <button class="left10px" mat-raised-button color="secondary" (click)="reset()">
                    <span class="mdi">clear_all</span>Reset</button>
            </div>
        </form>
        <div class="locale-list">
            <table mat-table [dataSource]="locales" *ngIf="locales && locales.length" class="mat-elevation-z8">
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name. </th>
                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                </ng-container>
                <ng-container matColumnDef="dealerCharge">
                    <th mat-header-cell *matHeaderCellDef> Dealer Charge. </th>
                    <td mat-cell *matCellDef="let element"> {{element.dealerCharge}}{{element.dealerChargeType === '%' ? element.dealerChargeType : ''}} </td>
                </ng-container>
                <ng-container matColumnDef="deliveryCharge">
                    <th mat-header-cell *matHeaderCellDef> Delivery Charge. </th>
                    <td mat-cell *matCellDef="let element"> {{element.deliveryCharge}}{{element.deliveryChargeType === '%' ? element.deliveryChargeType : ''}} </td>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row"> <span (click)="removeLocale(row)" class="mdi red">delete_outline</span> </td>
                  </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
    </div>
    <div class="apply-formula">
        <h3>Apply a Locale</h3>
        <form [formGroup]="newFormula">
            <mat-form-field>
                <mat-label>Choose a Category</mat-label>
                <mat-select formControlName="category" (selectionChange)="updateSubCategory($event)">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let category of categories" [value]="category">
                        {{category.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px">
                <mat-label>Choose a Sub Category</mat-label>
                <mat-select formControlName="subCategory">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let sCategory of subCategories" [value]="sCategory">
                        {{sCategory.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="left10px right10px">
                <mat-label>Locale</mat-label>
                <mat-select formControlName="locale">
                    <mat-option value=''>-Select-</mat-option>
                    <mat-option *ngFor="let d of locales" [value]="d">
                        {{d.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class="action-buttons">
                <button mat-raised-button color="primary" (click)="apply()"
                    [disabled]="!newFormula.value.category || !newFormula.value.locale"><span
                        class="mdi">schedule</span>Apply</button>
                <button class="left10px" mat-raised-button color="secondary"><span
                        class="mdi">clear_all</span>Reset</button>
            </div>
        </form>
        
        <div class="locale-list">
            <table mat-table [dataSource]="localeUpdates" *ngIf="localeUpdates && localeUpdates.length" class="mat-elevation-z8">
                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef> Category. </th>
                    <td mat-cell *matCellDef="let element"> {{element.category.name}} </td>
                </ng-container>
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> No. </th>
                    <td mat-cell *matCellDef="let element"> {{element.id}} </td>
                </ng-container>
                <ng-container matColumnDef="subCategory">
                    <th mat-header-cell *matHeaderCellDef> Sub-Category. </th>
                    <td mat-cell *matCellDef="let element"> {{element.subCategory.name}} </td>
                </ng-container>
                <ng-container matColumnDef="locale">
                    <th mat-header-cell *matHeaderCellDef> Locale. </th>
                    <td mat-cell *matCellDef="let element"> {{element.locale.name}} </td>
                </ng-container>
                <ng-container matColumnDef="message">
                    <th mat-header-cell *matHeaderCellDef> Products Updated. </th>
                    <td mat-cell *matCellDef="let element"> {{element.message}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedApplyColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedApplyColumns;"></tr>
            </table>
        </div>
    </div>
</div>